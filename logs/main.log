2023-09-07 13:45:54,565  ERROR       main.py  db_session_middleware  73  status: 500
params: 
path_params: /diff_scribble
time: 4.5297746658325195
traceback: home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/base.py", line 84, in call_next
    raise app_exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/cors.py", line 84, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 174, in diff_scribble
    for i in range(images):
TypeError: 'list' object cannot be interpreted as an integer

2023-09-07 15:26:43,308  ERROR       main.py  db_session_middleware  76  status: 500
params: 
path_params: /diff_upscaler
time: 0.2293233871459961
traceback: c/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 201, in diff_upscaler
    init_pipline("upscaler")
  File "/algo/gs/dl_aigc/main.py", line 119, in init_pipline
    app.state.pipeline = StableDiffusionUpscalePipeline.from_pretrained(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/pipeline_utils.py", line 932, in from_pretrained
    cached_folder = cls.download(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/pipeline_utils.py", line 1349, in download
    info = model_info(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/huggingface_hub/utils/_validators.py", line 118, in _inner_fn
    return fn(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/huggingface_hub/hf_api.py", line 1677, in model_info
    r = get_session().get(path, headers=headers, timeout=timeout, params=params)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/requests/sessions.py", line 602, in get
    return self.request("GET", url, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/requests/sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/requests/sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/huggingface_hub/utils/_http.py", line 63, in send
    return super().send(request, *args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/requests/adapters.py", line 501, in send
    raise ConnectionError(err, request=request)
requests.exceptions.ConnectionError: (ProtocolError('Connection aborted.', ConnectionResetError(104, 'Connection reset by peer')), '(Request ID: 156912a5-4f96-47ea-b2cb-01009dc5b069)')

2023-09-07 15:29:12,522  ERROR       main.py  db_session_middleware  76  status: 500
params: 
path_params: /diff_upscaler
time: 0.2607150077819824
traceback: c/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 201, in diff_upscaler
    init_pipline("upscaler")
  File "/algo/gs/dl_aigc/main.py", line 119, in init_pipline
    app.state.pipeline = StableDiffusionUpscalePipeline.from_pretrained(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/pipeline_utils.py", line 932, in from_pretrained
    cached_folder = cls.download(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/pipeline_utils.py", line 1349, in download
    info = model_info(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/huggingface_hub/utils/_validators.py", line 118, in _inner_fn
    return fn(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/huggingface_hub/hf_api.py", line 1677, in model_info
    r = get_session().get(path, headers=headers, timeout=timeout, params=params)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/requests/sessions.py", line 602, in get
    return self.request("GET", url, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/requests/sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/requests/sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/huggingface_hub/utils/_http.py", line 63, in send
    return super().send(request, *args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/requests/adapters.py", line 501, in send
    raise ConnectionError(err, request=request)
requests.exceptions.ConnectionError: (ProtocolError('Connection aborted.', ConnectionResetError(104, 'Connection reset by peer')), '(Request ID: 404fc527-19b1-4be9-b6bd-7f3f203ea097)')

2023-09-07 15:29:20,562  ERROR       main.py  db_session_middleware  76  status: 500
params: 
path_params: /diff_upscaler
time: 0.2407219409942627
traceback: c/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 201, in diff_upscaler
    init_pipline("upscaler")
  File "/algo/gs/dl_aigc/main.py", line 119, in init_pipline
    app.state.pipeline = StableDiffusionUpscalePipeline.from_pretrained(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/pipeline_utils.py", line 932, in from_pretrained
    cached_folder = cls.download(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/pipeline_utils.py", line 1349, in download
    info = model_info(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/huggingface_hub/utils/_validators.py", line 118, in _inner_fn
    return fn(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/huggingface_hub/hf_api.py", line 1677, in model_info
    r = get_session().get(path, headers=headers, timeout=timeout, params=params)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/requests/sessions.py", line 602, in get
    return self.request("GET", url, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/requests/sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/requests/sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/huggingface_hub/utils/_http.py", line 63, in send
    return super().send(request, *args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/requests/adapters.py", line 501, in send
    raise ConnectionError(err, request=request)
requests.exceptions.ConnectionError: (ProtocolError('Connection aborted.', ConnectionResetError(104, 'Connection reset by peer')), '(Request ID: 3609bdcf-c217-4c12-866e-cdf78a210fa1)')

2023-09-07 15:30:31,189  ERROR       main.py  db_session_middleware  76  status: 500
params: 
path_params: /diff_upscaler
time: 1.967294692993164
traceback: _error)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/cors.py", line 84, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 206, in diff_upscaler
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 166, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
TypeError: StableDiffusionUpscalePipeline.__call__() got an unexpected keyword argument 'width'

2023-09-07 15:34:33,883  ERROR       main.py  db_session_middleware  76  status: 500
params: 
path_params: /diff_upscaler
time: 2.7939391136169434
traceback: ilu'), ('norm_num_groups', 32), ('norm_eps', 1e-05), ('cross_attention_dim', 1024), ('transformer_layers_per_block', 1), ('encoder_hid_dim', None), ('encoder_hid_dim_type', None), ('attention_head_dim', 8), ('num_attention_heads', None), ('dual_cross_attention', False), ('use_linear_projection', True), ('class_embed_type', None), ('addition_embed_type', None), ('addition_time_embed_dim', None), ('num_class_embeds', 1000), ('upcast_attention', False), ('resnet_time_scale_shift', 'default'), ('resnet_skip_time_act', False), ('resnet_out_scale_factor', 1.0), ('time_embedding_type', 'positional'), ('time_embedding_dim', None), ('time_embedding_act_fn', None), ('timestep_post_act', None), ('time_cond_proj_dim', None), ('conv_in_kernel', 3), ('conv_out_kernel', 3), ('projection_class_embeddings_input_dim', None), ('attention_type', 'default'), ('class_embeddings_concat', False), ('mid_block_only_cross_attention', None), ('cross_attention_norm', None), ('addition_embed_type_num_heads', 64), ('_use_default_values', ['addition_embed_type_num_heads', 'encoder_hid_dim_type', 'encoder_hid_dim', 'addition_time_embed_dim', 'attention_type', 'conv_in_kernel', 'timestep_post_act', 'time_embedding_act_fn', 'mid_block_only_cross_attention', 'class_embed_type', 'resnet_skip_time_act', 'projection_class_embeddings_input_dim', 'cross_attention_norm', 'time_embedding_dim', 'transformer_layers_per_block', 'addition_embed_type', 'mid_block_type', 'upcast_attention', 'conv_out_kernel', 'num_attention_heads', 'time_embedding_type', 'class_embeddings_concat', 'time_cond_proj_dim', 'resnet_time_scale_shift', 'resnet_out_scale_factor']), ('_class_name', 'UNet2DConditionModel'), ('_diffusers_version', '0.9.0.dev0'), ('_name_or_path', 'models/models--stabilityai--stable-diffusion-x4-upscaler/snapshots/7b427816f5ce63180d60cc023de189b5d1d0360b/unet')]) expects 7 but received `num_channels_latents`: 4 + `num_channels_image`: 4  = 8. Please verify the config of `pipeline.unet` or your `image` input.

2023-09-07 15:38:17,055  ERROR       main.py  db_session_middleware  76  status: 500
params: 
path_params: /diff_upscaler
time: 152.90749192237854
traceback: /base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/cors.py", line 84, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 207, in diff_upscaler
    upscaled_image.save(Path(f"upscaled_results/upscaled_image.png"))
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/PIL/Image.py", line 2429, in save
    fp = builtins.open(filename, "w+b")
FileNotFoundError: [Errno 2] No such file or directory: 'upscaled_results/upscaled_image.png'

2023-09-07 15:39:42,551  ERROR       main.py  db_session_middleware  76  status: 500
params: 
path_params: /diff_upscaler
time: 0.26174426078796387
traceback: c/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 201, in diff_upscaler
    init_pipline("upscaler")
  File "/algo/gs/dl_aigc/main.py", line 119, in init_pipline
    app.state.pipeline = StableDiffusionUpscalePipeline.from_pretrained(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/pipeline_utils.py", line 932, in from_pretrained
    cached_folder = cls.download(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/pipeline_utils.py", line 1349, in download
    info = model_info(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/huggingface_hub/utils/_validators.py", line 118, in _inner_fn
    return fn(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/huggingface_hub/hf_api.py", line 1677, in model_info
    r = get_session().get(path, headers=headers, timeout=timeout, params=params)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/requests/sessions.py", line 602, in get
    return self.request("GET", url, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/requests/sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/requests/sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/huggingface_hub/utils/_http.py", line 63, in send
    return super().send(request, *args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/requests/adapters.py", line 501, in send
    raise ConnectionError(err, request=request)
requests.exceptions.ConnectionError: (ProtocolError('Connection aborted.', ConnectionResetError(104, 'Connection reset by peer')), '(Request ID: a3e5fcdc-f27e-40d7-a79c-be2971e952dc)')

2023-09-07 15:49:01,689  ERROR       main.py  db_session_middleware  76  status: 500
params: 
path_params: /diff_upscaler
time: 0.26188182830810547
traceback: c/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 201, in diff_upscaler
    init_pipline("upscaler")
  File "/algo/gs/dl_aigc/main.py", line 119, in init_pipline
    app.state.pipeline = StableDiffusionUpscalePipeline.from_pretrained(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/pipeline_utils.py", line 932, in from_pretrained
    cached_folder = cls.download(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/pipeline_utils.py", line 1349, in download
    info = model_info(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/huggingface_hub/utils/_validators.py", line 118, in _inner_fn
    return fn(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/huggingface_hub/hf_api.py", line 1677, in model_info
    r = get_session().get(path, headers=headers, timeout=timeout, params=params)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/requests/sessions.py", line 602, in get
    return self.request("GET", url, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/requests/sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/requests/sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/huggingface_hub/utils/_http.py", line 63, in send
    return super().send(request, *args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/requests/adapters.py", line 501, in send
    raise ConnectionError(err, request=request)
requests.exceptions.ConnectionError: (ProtocolError('Connection aborted.', ConnectionResetError(104, 'Connection reset by peer')), '(Request ID: 59e988a9-ca83-413c-b3b3-d09d82a0519c)')

2023-09-07 16:11:14,501  ERROR       main.py  db_session_middleware  76  status: 500
params: 
path_params: /diff_upscaler
time: 43.43397307395935
traceback: outing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 206, in diff_upscaler
    upscaled_image = app.state.pipeline(prompt=req.prompt, image=img).images[0]
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/stable_diffusion/pipeline_stable_diffusion_upscale.py", line 707, in __call__
    noise_pred = self.unet(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/unet_2d_condition.py", line 940, in forward
    sample, res_samples = downsample_block(hidden_states=sample, temb=emb)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/unet_2d_blocks.py", line 1150, in forward
    hidden_states = resnet(hidden_states, temb)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/resnet.py", line 639, in forward
    output_tensor = (input_tensor + hidden_states) / self.output_scale_factor
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 4.50 GiB (GPU 0; 39.39 GiB total capacity; 19.95 GiB already allocated; 4.49 GiB free; 33.52 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF

2023-09-07 16:13:34,141  ERROR       main.py  db_session_middleware  76  status: 500
params: 
path_params: /diff_upscaler
time: 51.003315687179565
traceback: s, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/transformer_2d.py", line 309, in forward
    hidden_states = block(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/attention.py", line 242, in forward
    ff_output = self.ff(norm_hidden_states)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/attention.py", line 300, in forward
    hidden_states = module(hidden_states)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/attention.py", line 346, in forward
    hidden_states, gate = self.proj(hidden_states).chunk(2, dim=-1)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/lora.py", line 115, in forward
    return super().forward(x)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/linear.py", line 114, in forward
    return F.linear(input, self.weight, self.bias)
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 18.00 GiB (GPU 0; 39.39 GiB total capacity; 27.75 GiB already allocated; 1.20 GiB free; 36.82 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF

2023-09-07 16:17:08,050  ERROR       main.py  db_session_middleware  76  status: 500
params: 
path_params: /diff_upscaler
time: 50.764240741729736
traceback: s, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/transformer_2d.py", line 309, in forward
    hidden_states = block(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/attention.py", line 242, in forward
    ff_output = self.ff(norm_hidden_states)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/attention.py", line 300, in forward
    hidden_states = module(hidden_states)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/attention.py", line 346, in forward
    hidden_states, gate = self.proj(hidden_states).chunk(2, dim=-1)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/lora.py", line 115, in forward
    return super().forward(x)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/linear.py", line 114, in forward
    return F.linear(input, self.weight, self.bias)
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 18.00 GiB (GPU 0; 39.39 GiB total capacity; 27.75 GiB already allocated; 1.20 GiB free; 36.82 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF

2023-09-07 16:18:23,537  ERROR       main.py  db_session_middleware  76  status: 500
params: 
path_params: /diff_upscaler
time: 55.07745671272278
traceback: s, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/transformer_2d.py", line 309, in forward
    hidden_states = block(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/attention.py", line 242, in forward
    ff_output = self.ff(norm_hidden_states)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/attention.py", line 300, in forward
    hidden_states = module(hidden_states)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/attention.py", line 346, in forward
    hidden_states, gate = self.proj(hidden_states).chunk(2, dim=-1)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/lora.py", line 115, in forward
    return super().forward(x)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/linear.py", line 114, in forward
    return F.linear(input, self.weight, self.bias)
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 18.00 GiB (GPU 0; 39.39 GiB total capacity; 27.64 GiB already allocated; 1.29 GiB free; 36.72 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF

2023-09-07 16:20:01,500  ERROR       main.py  db_session_middleware  76  status: 500
params: 
path_params: /diff_upscaler
time: 50.422527551651
traceback: s, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/transformer_2d.py", line 309, in forward
    hidden_states = block(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/attention.py", line 242, in forward
    ff_output = self.ff(norm_hidden_states)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/attention.py", line 300, in forward
    hidden_states = module(hidden_states)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/attention.py", line 346, in forward
    hidden_states, gate = self.proj(hidden_states).chunk(2, dim=-1)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/lora.py", line 115, in forward
    return super().forward(x)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/linear.py", line 114, in forward
    return F.linear(input, self.weight, self.bias)
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 18.00 GiB (GPU 0; 39.39 GiB total capacity; 27.64 GiB already allocated; 1.31 GiB free; 36.71 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF

2023-09-07 16:28:15,125  ERROR       main.py  db_session_middleware  76  status: 500
params: 
path_params: /diff_upscaler
time: 347.0572888851166
traceback: nvs/aigc/lib/python3.10/site-packages/diffusers/models/autoencoder_kl.py", line 270, in decode
    decoded = self._decode(z).sample
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/autoencoder_kl.py", line 257, in _decode
    dec = self.decoder(z)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/vae.py", line 271, in forward
    sample = up_block(sample, latent_embeds)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/unet_2d_blocks.py", line 2334, in forward
    hidden_states = upsampler(hidden_states)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/resnet.py", line 169, in forward
    hidden_states = self.conv(hidden_states)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/lora.py", line 96, in forward
    return F.conv2d(x, self.weight, self.bias, self.stride, self.padding, self.dilation, self.groups)
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 81.00 GiB (GPU 0; 39.39 GiB total capacity; 23.69 GiB already allocated; 14.14 GiB free; 23.87 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF

2023-09-07 16:48:11,001  ERROR       main.py  db_session_middleware  76  status: 500
params: 
path_params: /diff_upscaler
time: 117.20009112358093
traceback: nvs/aigc/lib/python3.10/site-packages/diffusers/models/autoencoder_kl.py", line 270, in decode
    decoded = self._decode(z).sample
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/autoencoder_kl.py", line 257, in _decode
    dec = self.decoder(z)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/vae.py", line 271, in forward
    sample = up_block(sample, latent_embeds)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/unet_2d_blocks.py", line 2334, in forward
    hidden_states = upsampler(hidden_states)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/resnet.py", line 169, in forward
    hidden_states = self.conv(hidden_states)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/lora.py", line 96, in forward
    return F.conv2d(x, self.weight, self.bias, self.stride, self.padding, self.dilation, self.groups)
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 72.00 GiB (GPU 0; 39.39 GiB total capacity; 23.14 GiB already allocated; 12.72 GiB free; 25.29 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF

2023-09-07 17:04:57,392  ERROR       main.py  db_session_middleware  76  status: 500
params: 
path_params: /diff_upscaler
time: 239.7862949371338
traceback: envs/aigc/lib/python3.10/site-packages/diffusers/models/autoencoder_kl.py", line 270, in decode
    decoded = self._decode(z).sample
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/autoencoder_kl.py", line 257, in _decode
    dec = self.decoder(z)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/vae.py", line 271, in forward
    sample = up_block(sample, latent_embeds)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/unet_2d_blocks.py", line 2334, in forward
    hidden_states = upsampler(hidden_states)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/resnet.py", line 169, in forward
    hidden_states = self.conv(hidden_states)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/lora.py", line 96, in forward
    return F.conv2d(x, self.weight, self.bias, self.stride, self.padding, self.dilation, self.groups)
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 14.06 GiB (GPU 0; 39.39 GiB total capacity; 25.78 GiB already allocated; 4.95 GiB free; 33.06 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF

2023-09-07 17:07:07,512  ERROR       main.py  db_session_middleware  76  status: 500
params: 
path_params: /diff_upscaler
time: 3.5678911209106445
traceback: me/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 211, in diff_upscaler
    upscaled_image = app.state.pipeline(prompt=req.prompt, image=img).images[0]
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/stable_diffusion/pipeline_stable_diffusion_upscale.py", line 707, in __call__
    noise_pred = self.unet(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/accelerate/hooks.py", line 165, in new_forward
    output = old_forward(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/unet_2d_condition.py", line 909, in forward
    sample = self.conv_in(sample)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/conv.py", line 463, in forward
    return self._conv_forward(input, self.weight, self.bias)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/conv.py", line 459, in _conv_forward
    return F.conv2d(input, weight, bias, self.stride,
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 49.44 GiB (GPU 0; 39.39 GiB total capacity; 4.14 GiB already allocated; 33.85 GiB free; 4.18 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF

2023-09-07 17:07:27,495  ERROR       main.py  db_session_middleware  76  status: 500
params: 
path_params: /diff_upscaler
time: 2.2718636989593506
traceback: me/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 211, in diff_upscaler
    upscaled_image = app.state.pipeline(prompt=req.prompt, image=img).images[0]
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/stable_diffusion/pipeline_stable_diffusion_upscale.py", line 707, in __call__
    noise_pred = self.unet(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/accelerate/hooks.py", line 165, in new_forward
    output = old_forward(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/unet_2d_condition.py", line 909, in forward
    sample = self.conv_in(sample)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/conv.py", line 463, in forward
    return self._conv_forward(input, self.weight, self.bias)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/conv.py", line 459, in _conv_forward
    return F.conv2d(input, weight, bias, self.stride,
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 49.44 GiB (GPU 0; 39.39 GiB total capacity; 6.75 GiB already allocated; 31.23 GiB free; 6.79 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF

2023-09-07 17:08:03,194  ERROR       main.py  db_session_middleware  76  status: 500
params: 
path_params: /diff_upscaler
time: 3.3167834281921387
traceback: me/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 211, in diff_upscaler
    upscaled_image = app.state.pipeline(prompt=req.prompt, image=img).images[0]
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/stable_diffusion/pipeline_stable_diffusion_upscale.py", line 707, in __call__
    noise_pred = self.unet(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/accelerate/hooks.py", line 165, in new_forward
    output = old_forward(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/unet_2d_condition.py", line 909, in forward
    sample = self.conv_in(sample)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/conv.py", line 463, in forward
    return self._conv_forward(input, self.weight, self.bias)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/conv.py", line 459, in _conv_forward
    return F.conv2d(input, weight, bias, self.stride,
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 49.44 GiB (GPU 0; 39.39 GiB total capacity; 4.13 GiB already allocated; 33.12 GiB free; 4.89 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF

2023-09-07 17:10:19,351  ERROR       main.py  db_session_middleware  76  status: 500
params: 
path_params: /diff_upscaler
time: 3.229875087738037
traceback: s, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/transformer_2d.py", line 309, in forward
    hidden_states = block(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/attention.py", line 242, in forward
    ff_output = self.ff(norm_hidden_states)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/attention.py", line 300, in forward
    hidden_states = module(hidden_states)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/attention.py", line 346, in forward
    hidden_states, gate = self.proj(hidden_states).chunk(2, dim=-1)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/lora.py", line 115, in forward
    return super().forward(x)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/linear.py", line 114, in forward
    return F.linear(input, self.weight, self.bias)
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 14.06 GiB (GPU 0; 39.39 GiB total capacity; 21.93 GiB already allocated; 8.00 GiB free; 30.01 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF

2023-09-07 17:11:00,412  ERROR       main.py  db_session_middleware  76  status: 500
params: 
path_params: /diff_upscaler
time: 3.314622402191162
traceback: s, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/transformer_2d.py", line 309, in forward
    hidden_states = block(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/attention.py", line 242, in forward
    ff_output = self.ff(norm_hidden_states)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/attention.py", line 300, in forward
    hidden_states = module(hidden_states)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/attention.py", line 346, in forward
    hidden_states, gate = self.proj(hidden_states).chunk(2, dim=-1)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/lora.py", line 115, in forward
    return super().forward(x)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/linear.py", line 114, in forward
    return F.linear(input, self.weight, self.bias)
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 13.77 GiB (GPU 0; 39.39 GiB total capacity; 21.51 GiB already allocated; 8.58 GiB free; 29.43 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF

2023-09-07 17:12:23,595  ERROR       main.py  db_session_middleware  76  status: 500
params: 
path_params: /diff_upscaler
time: 6.119530916213989
traceback:  forward
    sample = upsample_block(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/unet_2d_blocks.py", line 2187, in forward
    hidden_states = attn(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/transformer_2d.py", line 309, in forward
    hidden_states = block(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/attention.py", line 242, in forward
    ff_output = self.ff(norm_hidden_states)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/attention.py", line 300, in forward
    hidden_states = module(hidden_states)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/attention.py", line 347, in forward
    return hidden_states * self.gelu(gate)
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 3.96 GiB (GPU 0; 39.39 GiB total capacity; 27.84 GiB already allocated; 1.76 GiB free; 36.25 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF

2023-09-07 17:13:14,850  ERROR       main.py  db_session_middleware  76  status: 500
params: 
path_params: /diff_upscaler
time: 8.11148452758789
traceback: orward
    sample = upsample_block(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/unet_2d_blocks.py", line 2187, in forward
    hidden_states = attn(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/transformer_2d.py", line 309, in forward
    hidden_states = block(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/attention.py", line 242, in forward
    ff_output = self.ff(norm_hidden_states)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/attention.py", line 300, in forward
    hidden_states = module(hidden_states)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/attention.py", line 347, in forward
    return hidden_states * self.gelu(gate)
torch.cuda.OutOfMemoryError: CUDA out of memory. Tried to allocate 3.96 GiB (GPU 0; 39.39 GiB total capacity; 27.84 GiB already allocated; 812.44 MiB free; 37.22 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF

2023-09-13 16:07:40,725  ERROR       main.py  db_session_middleware  77  status: 500
params: 
path_params: /diff_scribble
time: 15.897814273834229
traceback: /home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/cors.py", line 84, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 198, in diff_scribble
    img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 152, in scribble_pic
    cv_img = base64_cv(base64str)
  File "/algo/gs/dl_aigc/img_util.py", line 17, in base64_cv
    im_bytes = base64.b64decode(base64str)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/base64.py", line 87, in b64decode
    return binascii.a2b_base64(s)
binascii.Error: Incorrect padding

2023-09-13 16:07:40,726  ERROR       main.py  db_session_middleware  77  status: 500
params: 
path_params: /diff_scribble
time: 15.899340391159058
traceback: /home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/cors.py", line 84, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 198, in diff_scribble
    img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 152, in scribble_pic
    cv_img = base64_cv(base64str)
  File "/algo/gs/dl_aigc/img_util.py", line 17, in base64_cv
    im_bytes = base64.b64decode(base64str)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/base64.py", line 87, in b64decode
    return binascii.a2b_base64(s)
binascii.Error: Incorrect padding

2023-09-13 16:07:40,727  ERROR       main.py  db_session_middleware  77  status: 500
params: 
path_params: /diff_scribble
time: 15.899839162826538
traceback: /home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/cors.py", line 84, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 198, in diff_scribble
    img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 152, in scribble_pic
    cv_img = base64_cv(base64str)
  File "/algo/gs/dl_aigc/img_util.py", line 17, in base64_cv
    im_bytes = base64.b64decode(base64str)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/base64.py", line 87, in b64decode
    return binascii.a2b_base64(s)
binascii.Error: Incorrect padding

2023-09-13 16:07:40,728  ERROR       main.py  db_session_middleware  77  status: 500
params: 
path_params: /diff_scribble
time: 15.90031099319458
traceback: /home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/cors.py", line 84, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 198, in diff_scribble
    img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 152, in scribble_pic
    cv_img = base64_cv(base64str)
  File "/algo/gs/dl_aigc/img_util.py", line 17, in base64_cv
    im_bytes = base64.b64decode(base64str)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/base64.py", line 87, in b64decode
    return binascii.a2b_base64(s)
binascii.Error: Incorrect padding

2023-09-14 14:27:03,514  ERROR       main.py  db_session_middleware  79  status: 500
params: 
path_params: /diff_scribble_img2img
time: 0.4388258457183838
traceback: r)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/cors.py", line 84, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 260, in diff_scribble_img2img
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 205, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/datastructures.py", line 705, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'pipeline'

2023-09-14 14:27:36,859  ERROR       main.py  db_session_middleware  79  status: 500
params: 
path_params: /diff_scribble_img2img
time: 0.4194157123565674
traceback: r)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/cors.py", line 84, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 260, in diff_scribble_img2img
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 205, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/datastructures.py", line 705, in __getattr__
    raise AttributeError(message.format(self.__class__.__name__, key))
AttributeError: 'State' object has no attribute 'pipeline'

2023-09-14 14:29:01,071  ERROR       main.py  db_session_middleware  80  status: 500
params: 
path_params: /diff_scribble_img2img
time: 6.52093505859375
traceback: c/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 261, in diff_scribble_img2img
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 206, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py", line 898, in __call__
    self.check_inputs(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py", line 541, in check_inputs
    self.check_image(image, prompt, prompt_embeds)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py", line 628, in check_image
    raise TypeError(
TypeError: image must be passed and be one of PIL image, numpy array, torch tensor, list of PIL images, list of numpy arrays or list of torch tensors, but is <class 'NoneType'>

2023-09-14 14:30:06,204  ERROR       main.py  db_session_middleware  80  status: 500
params: 
path_params: /diff_scribble_img2img
time: 7.3919947147369385
traceback: yncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 261, in diff_scribble_img2img
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 223, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py", line 1040, in __call__
    down_block_res_samples, mid_block_res_sample = self.controlnet(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/controlnet.py", line 754, in forward
    sample = sample + controlnet_cond
RuntimeError: The size of tensor a (200) must match the size of tensor b (121) at non-singleton dimension 3

2023-09-14 14:31:46,533  ERROR       main.py  db_session_middleware  80  status: 500
params: 
path_params: /diff_scribble_img2img
time: 0.8537499904632568
traceback: yncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 261, in diff_scribble_img2img
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 223, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py", line 1040, in __call__
    down_block_res_samples, mid_block_res_sample = self.controlnet(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/controlnet.py", line 754, in forward
    sample = sample + controlnet_cond
RuntimeError: The size of tensor a (200) must match the size of tensor b (121) at non-singleton dimension 3

2023-09-14 14:34:15,963  ERROR       main.py  db_session_middleware  81  status: 500
params: 
path_params: /diff_scribble_img2img
time: 16.673274040222168
traceback: syncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 263, in diff_scribble_img2img
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 224, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py", line 1040, in __call__
    down_block_res_samples, mid_block_res_sample = self.controlnet(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/controlnet.py", line 754, in forward
    sample = sample + controlnet_cond
RuntimeError: The size of tensor a (50) must match the size of tensor b (121) at non-singleton dimension 3

2023-09-14 14:36:44,860  ERROR       main.py  db_session_middleware  81  status: 500
params: 
path_params: /diff_scribble_img2img
time: 16.87161684036255
traceback: syncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 263, in diff_scribble_img2img
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 224, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py", line 1040, in __call__
    down_block_res_samples, mid_block_res_sample = self.controlnet(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/controlnet.py", line 754, in forward
    sample = sample + controlnet_cond
RuntimeError: The size of tensor a (50) must match the size of tensor b (200) at non-singleton dimension 3

2023-09-14 14:40:56,157  ERROR       main.py  db_session_middleware  81  status: 500
params: 
path_params: /diff_scribble_img2img
time: 141.33427262306213
traceback: go/gs/dl_aigc/main.py", line 151, in init_pipline
    app.state.pipeline = StableDiffusionControlNetImg2ImgPipeline.from_pretrained(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/pipeline_utils.py", line 932, in from_pretrained
    cached_folder = cls.download(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/pipeline_utils.py", line 1349, in download
    info = model_info(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/huggingface_hub/utils/_validators.py", line 118, in _inner_fn
    return fn(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/huggingface_hub/hf_api.py", line 1677, in model_info
    r = get_session().get(path, headers=headers, timeout=timeout, params=params)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/requests/sessions.py", line 602, in get
    return self.request("GET", url, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/requests/sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/requests/sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/huggingface_hub/utils/_http.py", line 63, in send
    return super().send(request, *args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/requests/adapters.py", line 519, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: (MaxRetryError("HTTPSConnectionPool(host='huggingface.co', port=443): Max retries exceeded with url: /api/models/runwayml/stable-diffusion-v1-5 (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x7f931c4bcb50>: Failed to establish a new connection: [Errno 101] Network is unreachable'))"), '(Request ID: bb3cf76a-fca2-4fb5-9dd1-5f707096e83c)')

2023-09-14 14:43:17,466  ERROR       main.py  db_session_middleware  81  status: 500
params: 
path_params: /diff_scribble_img2img
time: 141.30710291862488
traceback: img2img
    async def diff_scribble_img2img(req: ScribbleConfig):
  File "/algo/gs/dl_aigc/main.py", line 151, in init_pipline
    )
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/pipeline_utils.py", line 932, in from_pretrained
    cached_folder = cls.download(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/pipeline_utils.py", line 1349, in download
    info = model_info(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/huggingface_hub/utils/_validators.py", line 118, in _inner_fn
    return fn(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/huggingface_hub/hf_api.py", line 1677, in model_info
    r = get_session().get(path, headers=headers, timeout=timeout, params=params)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/requests/sessions.py", line 602, in get
    return self.request("GET", url, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/requests/sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/requests/sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/huggingface_hub/utils/_http.py", line 63, in send
    return super().send(request, *args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/requests/adapters.py", line 519, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: (MaxRetryError("HTTPSConnectionPool(host='huggingface.co', port=443): Max retries exceeded with url: /api/models/runwayml/stable-diffusion-v1-5 (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x7f9317a63ca0>: Failed to establish a new connection: [Errno 101] Network is unreachable'))"), '(Request ID: 3d1f801d-2c5b-479b-8603-a9262cdf93d7)')

2023-09-14 14:43:52,313  ERROR       main.py  db_session_middleware  81  status: 500
params: 
path_params: /diff_scribble_img2img
time: 10.021985530853271
traceback: gc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 254, in diff_scribble_img2img
    init_pipline("scribble_img2img")
  File "/algo/gs/dl_aigc/main.py", line 145, in init_pipline
    controlnet = ControlNetModel.from_pretrained(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/modeling_utils.py", line 528, in from_pretrained
    config, unused_kwargs, commit_hash = cls.load_config(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/configuration_utils.py", line 397, in load_config
    raise EnvironmentError(
OSError: lllyasviel/sd-controlnet-canny does not appear to have a file named config.json.

2023-09-14 14:45:30,327  ERROR       main.py  db_session_middleware  81  status: 500
params: 
path_params: /diff_scribble_img2img
time: 16.8550808429718
traceback: syncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 264, in diff_scribble_img2img
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 225, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py", line 1040, in __call__
    down_block_res_samples, mid_block_res_sample = self.controlnet(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/controlnet.py", line 754, in forward
    sample = sample + controlnet_cond
RuntimeError: The size of tensor a (50) must match the size of tensor b (121) at non-singleton dimension 3

2023-09-14 14:49:58,876  ERROR       main.py  db_session_middleware  81  status: 500
params: 
path_params: /diff_scribble_img2img
time: 141.53222179412842
traceback: go/gs/dl_aigc/main.py", line 152, in init_pipline
    app.state.pipeline = StableDiffusionControlNetImg2ImgPipeline.from_pretrained(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/pipeline_utils.py", line 932, in from_pretrained
    cached_folder = cls.download(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/pipeline_utils.py", line 1349, in download
    info = model_info(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/huggingface_hub/utils/_validators.py", line 118, in _inner_fn
    return fn(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/huggingface_hub/hf_api.py", line 1677, in model_info
    r = get_session().get(path, headers=headers, timeout=timeout, params=params)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/requests/sessions.py", line 602, in get
    return self.request("GET", url, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/requests/sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/requests/sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/huggingface_hub/utils/_http.py", line 63, in send
    return super().send(request, *args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/requests/adapters.py", line 519, in send
    raise ConnectionError(e, request=request)
requests.exceptions.ConnectionError: (MaxRetryError("HTTPSConnectionPool(host='huggingface.co', port=443): Max retries exceeded with url: /api/models/runwayml/stable-diffusion-v1-5 (Caused by NewConnectionError('<urllib3.connection.HTTPSConnection object at 0x7f42071d4be0>: Failed to establish a new connection: [Errno 101] Network is unreachable'))"), '(Request ID: f51f8c55-087b-44ad-813e-26911b1d2105)')

2023-09-14 14:49:59,622  ERROR       main.py  db_session_middleware  81  status: 500
params: 
path_params: /diff_scribble_img2img
time: 0.7448534965515137
traceback: ages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 255, in diff_scribble_img2img
    init_pipline("scribble_img2img")
  File "/algo/gs/dl_aigc/main.py", line 152, in init_pipline
    app.state.pipeline = StableDiffusionControlNetImg2ImgPipeline.from_pretrained(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/pipeline_utils.py", line 932, in from_pretrained
    cached_folder = cls.download(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/pipeline_utils.py", line 1349, in download
    info = model_info(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/huggingface_hub/utils/_validators.py", line 118, in _inner_fn
    return fn(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/huggingface_hub/hf_api.py", line 1677, in model_info
    r = get_session().get(path, headers=headers, timeout=timeout, params=params)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/requests/sessions.py", line 602, in get
    return self.request("GET", url, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/requests/sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/requests/sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/huggingface_hub/utils/_http.py", line 63, in send
    return super().send(request, *args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/requests/adapters.py", line 501, in send
    raise ConnectionError(err, request=request)
requests.exceptions.ConnectionError: (ProtocolError('Connection aborted.', ConnectionResetError(104, 'Connection reset by peer')), '(Request ID: 9162ab96-4c6d-4c8d-a6ab-aa0ba93323f1)')

2023-09-14 14:50:55,302  ERROR       main.py  db_session_middleware  81  status: 500
params: 
path_params: /diff_scribble_img2img
time: 9.07123875617981
traceback: syncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 265, in diff_scribble_img2img
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 226, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py", line 1040, in __call__
    down_block_res_samples, mid_block_res_sample = self.controlnet(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/controlnet.py", line 754, in forward
    sample = sample + controlnet_cond
RuntimeError: The size of tensor a (50) must match the size of tensor b (121) at non-singleton dimension 3

2023-09-14 15:51:08,167  ERROR       main.py  db_session_middleware  81  status: 500
params: 
path_params: /diff_scribble_img2img
time: 3478.66161775589
traceback: syncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 265, in diff_scribble_img2img
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 226, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py", line 1040, in __call__
    down_block_res_samples, mid_block_res_sample = self.controlnet(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/controlnet.py", line 754, in forward
    sample = sample + controlnet_cond
RuntimeError: The size of tensor a (50) must match the size of tensor b (121) at non-singleton dimension 3

2023-09-14 15:52:48,863  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble_img2img
time: 8.16762638092041
traceback: b/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 267, in diff_scribble_img2img
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 227, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py", line 949, in __call__
    image = self.image_processor.preprocess(image).to(dtype=torch.float32)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/image_processor.py", line 179, in preprocess
    raise ValueError(
ValueError: Currently we only support resizing for PIL image - please resize your numpy array to be divisible by 8currently the sizes are 266 and 400. You can also pass a PIL image instead to use resize option in VAEImageProcessor

2023-09-14 15:54:51,384  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble_img2img
time: 9.14607834815979
traceback: syncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 267, in diff_scribble_img2img
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 227, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py", line 1040, in __call__
    down_block_res_samples, mid_block_res_sample = self.controlnet(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/controlnet.py", line 754, in forward
    sample = sample + controlnet_cond
RuntimeError: The size of tensor a (50) must match the size of tensor b (121) at non-singleton dimension 3

2023-09-14 15:56:29,889  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble_img2img
time: 9.670796871185303
traceback: b/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 267, in diff_scribble_img2img
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 227, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py", line 949, in __call__
    image = self.image_processor.preprocess(image).to(dtype=torch.float32)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/image_processor.py", line 179, in preprocess
    raise ValueError(
ValueError: Currently we only support resizing for PIL image - please resize your numpy array to be divisible by 8currently the sizes are 266 and 400. You can also pass a PIL image instead to use resize option in VAEImageProcessor

2023-09-14 16:00:12,224  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble_img2img
time: 11.090574264526367
traceback: syncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 267, in diff_scribble_img2img
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 227, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py", line 1040, in __call__
    down_block_res_samples, mid_block_res_sample = self.controlnet(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/controlnet.py", line 754, in forward
    sample = sample + controlnet_cond
RuntimeError: The size of tensor a (50) must match the size of tensor b (121) at non-singleton dimension 3

2023-09-14 16:00:38,581  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble_img2img
time: 9.575851917266846
traceback: thon3.10/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/cors.py", line 84, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 265, in diff_scribble_img2img
    img_ref = Image.open(req.filepath_ref).convert("BGR")
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/PIL/Image.py", line 1077, in convert
    im = self.im.convert(mode, dither)
ValueError: conversion from RGB to BGR not supported

2023-09-14 16:01:21,921  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble_img2img
time: 14.723419904708862
traceback: syncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 267, in diff_scribble_img2img
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 227, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py", line 1040, in __call__
    down_block_res_samples, mid_block_res_sample = self.controlnet(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/controlnet.py", line 754, in forward
    sample = sample + controlnet_cond
RuntimeError: The size of tensor a (50) must match the size of tensor b (121) at non-singleton dimension 3

2023-09-14 16:04:48,807  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble_img2img
time: 8.57040810585022
traceback: ython3.10/site-packages/starlette/middleware/cors.py", line 84, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 260, in diff_scribble_img2img
    control_img = scribble_xdog(cv2.imread('req.filepath'), res=512, thr_a=16)
  File "/algo/gs/dl_aigc/xdog.py", line 45, in scribble_xdog
    img, remove_pad = resize_image_with_pad(img, res)
  File "/algo/gs/dl_aigc/xdog.py", line 28, in resize_image_with_pad
    img = HWC3(input_image)
  File "/algo/gs/dl_aigc/xdog.py", line 9, in HWC3
    assert x.dtype == np.uint8
AttributeError: 'NoneType' object has no attribute 'dtype'

2023-09-14 16:05:21,590  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble_img2img
time: 8.42374038696289
traceback: b/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 268, in diff_scribble_img2img
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 227, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py", line 949, in __call__
    image = self.image_processor.preprocess(image).to(dtype=torch.float32)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/image_processor.py", line 179, in preprocess
    raise ValueError(
ValueError: Currently we only support resizing for PIL image - please resize your numpy array to be divisible by 8currently the sizes are 266 and 400. You can also pass a PIL image instead to use resize option in VAEImageProcessor

2023-09-14 16:06:10,427  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble_img2img
time: 9.48777961730957
traceback: b/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 268, in diff_scribble_img2img
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 227, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py", line 949, in __call__
    image = self.image_processor.preprocess(image).to(dtype=torch.float32)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/image_processor.py", line 179, in preprocess
    raise ValueError(
ValueError: Currently we only support resizing for PIL image - please resize your numpy array to be divisible by 8currently the sizes are 266 and 400. You can also pass a PIL image instead to use resize option in VAEImageProcessor

2023-09-14 16:10:02,875  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble_img2img
time: 9.089886903762817
traceback: b/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 268, in diff_scribble_img2img
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 227, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py", line 949, in __call__
    image = self.image_processor.preprocess(image).to(dtype=torch.float32)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/image_processor.py", line 179, in preprocess
    raise ValueError(
ValueError: Currently we only support resizing for PIL image - please resize your numpy array to be divisible by 8currently the sizes are 266 and 400. You can also pass a PIL image instead to use resize option in VAEImageProcessor

2023-09-14 16:13:27,987  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble_img2img
time: 8.885801076889038
traceback: syncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 268, in diff_scribble_img2img
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 227, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py", line 1040, in __call__
    down_block_res_samples, mid_block_res_sample = self.controlnet(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/diffusers/models/controlnet.py", line 754, in forward
    sample = sample + controlnet_cond
RuntimeError: The size of tensor a (50) must match the size of tensor b (104) at non-singleton dimension 3

2023-09-14 16:52:57,973  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble_img2img
time: 16.004207849502563
traceback: scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 260, in diff_scribble_img2img
    control_img = scribble_pic(req.filepath, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 189, in scribble_pic
    cv_img = scribble_xdog(cv_img, res=1024, thr_a=16)
  File "/algo/gs/dl_aigc/xdog.py", line 45, in scribble_xdog
    img, remove_pad = resize_image_with_pad(img, res)
  File "/algo/gs/dl_aigc/xdog.py", line 28, in resize_image_with_pad
    img = HWC3(input_image)
  File "/algo/gs/dl_aigc/xdog.py", line 9, in HWC3
    assert x.dtype == np.uint8
AttributeError: 'NoneType' object has no attribute 'dtype'

2023-09-14 16:54:23,946  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble_img2img
time: 16.04840850830078
traceback: scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 260, in diff_scribble_img2img
    control_img = scribble_pic(req.filepath, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 189, in scribble_pic
    cv_img = scribble_xdog(cv_img, res=1024, thr_a=16)
  File "/algo/gs/dl_aigc/xdog.py", line 45, in scribble_xdog
    img, remove_pad = resize_image_with_pad(img, res)
  File "/algo/gs/dl_aigc/xdog.py", line 28, in resize_image_with_pad
    img = HWC3(input_image)
  File "/algo/gs/dl_aigc/xdog.py", line 9, in HWC3
    assert x.dtype == np.uint8
AttributeError: 'NoneType' object has no attribute 'dtype'

2023-09-14 16:55:08,455  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble_img2img
time: 16.914024114608765
traceback: hon3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 267, in diff_scribble_img2img
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 227, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py", line 1019, in __call__
    down_block_res_samples, mid_block_res_sample = self.controlnet(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/models/controlnet.py", line 769, in forward
    sample = sample + controlnet_cond
RuntimeError: The size of tensor a (64) must match the size of tensor b (128) at non-singleton dimension 3

2023-09-14 16:56:01,707  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble_img2img
time: 16.733131647109985
traceback: hon3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 268, in diff_scribble_img2img
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 227, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py", line 1019, in __call__
    down_block_res_samples, mid_block_res_sample = self.controlnet(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/models/controlnet.py", line 769, in forward
    sample = sample + controlnet_cond
RuntimeError: The size of tensor a (64) must match the size of tensor b (128) at non-singleton dimension 3

2023-09-14 16:57:57,096  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble_img2img
time: 16.95772409439087
traceback: hon3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 268, in diff_scribble_img2img
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 227, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py", line 1019, in __call__
    down_block_res_samples, mid_block_res_sample = self.controlnet(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/models/controlnet.py", line 769, in forward
    sample = sample + controlnet_cond
RuntimeError: The size of tensor a (64) must match the size of tensor b (128) at non-singleton dimension 3

2023-09-14 17:19:18,630  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble
time: 31.27927255630493
traceback: lf.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 245, in diff_scribble
    control_img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 189, in scribble_pic
    cv_img = scribble_xdog(cv_img, res=1024, thr_a=16)
  File "/algo/gs/dl_aigc/xdog.py", line 45, in scribble_xdog
    img, remove_pad = resize_image_with_pad(img, res)
  File "/algo/gs/dl_aigc/xdog.py", line 28, in resize_image_with_pad
    img = HWC3(input_image)
  File "/algo/gs/dl_aigc/xdog.py", line 9, in HWC3
    assert x.dtype == np.uint8
AttributeError: 'NoneType' object has no attribute 'dtype'

2023-09-14 17:19:18,631  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble
time: 31.280412673950195
traceback: lf.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 245, in diff_scribble
    control_img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 189, in scribble_pic
    cv_img = scribble_xdog(cv_img, res=1024, thr_a=16)
  File "/algo/gs/dl_aigc/xdog.py", line 45, in scribble_xdog
    img, remove_pad = resize_image_with_pad(img, res)
  File "/algo/gs/dl_aigc/xdog.py", line 28, in resize_image_with_pad
    img = HWC3(input_image)
  File "/algo/gs/dl_aigc/xdog.py", line 9, in HWC3
    assert x.dtype == np.uint8
AttributeError: 'NoneType' object has no attribute 'dtype'

2023-09-14 17:19:18,631  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble
time: 31.28067970275879
traceback: lf.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 245, in diff_scribble
    control_img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 189, in scribble_pic
    cv_img = scribble_xdog(cv_img, res=1024, thr_a=16)
  File "/algo/gs/dl_aigc/xdog.py", line 45, in scribble_xdog
    img, remove_pad = resize_image_with_pad(img, res)
  File "/algo/gs/dl_aigc/xdog.py", line 28, in resize_image_with_pad
    img = HWC3(input_image)
  File "/algo/gs/dl_aigc/xdog.py", line 9, in HWC3
    assert x.dtype == np.uint8
AttributeError: 'NoneType' object has no attribute 'dtype'

2023-09-14 17:19:18,632  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble
time: 31.28098726272583
traceback: lf.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 245, in diff_scribble
    control_img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 189, in scribble_pic
    cv_img = scribble_xdog(cv_img, res=1024, thr_a=16)
  File "/algo/gs/dl_aigc/xdog.py", line 45, in scribble_xdog
    img, remove_pad = resize_image_with_pad(img, res)
  File "/algo/gs/dl_aigc/xdog.py", line 28, in resize_image_with_pad
    img = HWC3(input_image)
  File "/algo/gs/dl_aigc/xdog.py", line 9, in HWC3
    assert x.dtype == np.uint8
AttributeError: 'NoneType' object has no attribute 'dtype'

2023-09-14 17:19:18,632  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble_img2img
time: 31.28130316734314
traceback: hon3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 270, in diff_scribble_img2img
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 228, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py", line 1019, in __call__
    down_block_res_samples, mid_block_res_sample = self.controlnet(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/models/controlnet.py", line 769, in forward
    sample = sample + controlnet_cond
RuntimeError: The size of tensor a (64) must match the size of tensor b (121) at non-singleton dimension 3

2023-09-14 17:19:18,886  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble_img2img
time: 0.22330713272094727
traceback: hon3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 270, in diff_scribble_img2img
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 228, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py", line 1019, in __call__
    down_block_res_samples, mid_block_res_sample = self.controlnet(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/models/controlnet.py", line 769, in forward
    sample = sample + controlnet_cond
RuntimeError: The size of tensor a (64) must match the size of tensor b (121) at non-singleton dimension 3

2023-09-14 17:19:54,814  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble_img2img
time: 16.932373523712158
traceback: hon3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 270, in diff_scribble_img2img
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 228, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py", line 1019, in __call__
    down_block_res_samples, mid_block_res_sample = self.controlnet(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/models/controlnet.py", line 769, in forward
    sample = sample + controlnet_cond
RuntimeError: The size of tensor a (64) must match the size of tensor b (128) at non-singleton dimension 3

2023-09-14 17:20:16,960  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble_img2img
time: 6.811559677124023
traceback: hon3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 270, in diff_scribble_img2img
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 228, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py", line 1019, in __call__
    down_block_res_samples, mid_block_res_sample = self.controlnet(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/models/controlnet.py", line 769, in forward
    sample = sample + controlnet_cond
RuntimeError: The size of tensor a (64) must match the size of tensor b (128) at non-singleton dimension 3

2023-09-14 17:28:21,065  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble_img2img
time: 16.634222745895386
traceback: thon3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 270, in diff_scribble_img2img
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 228, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py", line 1019, in __call__
    down_block_res_samples, mid_block_res_sample = self.controlnet(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/models/controlnet.py", line 769, in forward
    sample = sample + controlnet_cond
RuntimeError: The size of tensor a (64) must match the size of tensor b (72) at non-singleton dimension 3

2023-09-14 17:29:25,456  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble_img2img
time: 16.782488346099854
traceback: thon3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 270, in diff_scribble_img2img
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 228, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py", line 1019, in __call__
    down_block_res_samples, mid_block_res_sample = self.controlnet(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/models/controlnet.py", line 769, in forward
    sample = sample + controlnet_cond
RuntimeError: The size of tensor a (64) must match the size of tensor b (72) at non-singleton dimension 3

2023-09-14 17:32:11,454  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble_img2img
time: 16.746129035949707
traceback: thon3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 271, in diff_scribble_img2img
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 229, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py", line 1019, in __call__
    down_block_res_samples, mid_block_res_sample = self.controlnet(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/models/controlnet.py", line 769, in forward
    sample = sample + controlnet_cond
RuntimeError: The size of tensor a (64) must match the size of tensor b (72) at non-singleton dimension 3

2023-09-14 17:34:00,764  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble_img2img
time: 16.51718759536743
traceback: thon3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 272, in diff_scribble_img2img
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 230, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py", line 1019, in __call__
    down_block_res_samples, mid_block_res_sample = self.controlnet(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/models/controlnet.py", line 769, in forward
    sample = sample + controlnet_cond
RuntimeError: The size of tensor a (64) must match the size of tensor b (72) at non-singleton dimension 3

2023-09-14 17:34:58,241  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble_img2img
time: 16.722180604934692
traceback: thon3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 272, in diff_scribble_img2img
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 230, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py", line 1019, in __call__
    down_block_res_samples, mid_block_res_sample = self.controlnet(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/models/controlnet.py", line 769, in forward
    sample = sample + controlnet_cond
RuntimeError: The size of tensor a (64) must match the size of tensor b (72) at non-singleton dimension 3

2023-09-14 17:38:53,621  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble_img2img
time: 6.89335560798645
traceback: thon3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 272, in diff_scribble_img2img
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 230, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py", line 1019, in __call__
    down_block_res_samples, mid_block_res_sample = self.controlnet(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/models/controlnet.py", line 769, in forward
    sample = sample + controlnet_cond
RuntimeError: The size of tensor a (64) must match the size of tensor b (72) at non-singleton dimension 3

2023-09-14 18:11:24,141  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble_img2img
time: 16.58757209777832
traceback: hon3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 273, in diff_scribble_img2img
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 230, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py", line 1019, in __call__
    down_block_res_samples, mid_block_res_sample = self.controlnet(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/models/controlnet.py", line 769, in forward
    sample = sample + controlnet_cond
RuntimeError: The size of tensor a (64) must match the size of tensor b (128) at non-singleton dimension 3

2023-09-14 18:14:38,075  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble_img2img
time: 0.4717586040496826
traceback: on3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 273, in diff_scribble_img2img
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 230, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py", line 1019, in __call__
    down_block_res_samples, mid_block_res_sample = self.controlnet(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/models/controlnet.py", line 769, in forward
    sample = sample + controlnet_cond
RuntimeError: The size of tensor a (128) must match the size of tensor b (200) at non-singleton dimension 3

2023-09-15 10:32:08,255  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble_img2img
time: 7.073298692703247
traceback: hon3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 284, in diff_scribble_img2img
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 241, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py", line 1019, in __call__
    down_block_res_samples, mid_block_res_sample = self.controlnet(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/models/controlnet.py", line 769, in forward
    sample = sample + controlnet_cond
RuntimeError: The size of tensor a (128) must match the size of tensor b (64) at non-singleton dimension 3

2023-09-15 10:34:37,468  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble_img2img
time: 16.652222156524658
traceback: hon3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 284, in diff_scribble_img2img
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 241, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py", line 1019, in __call__
    down_block_res_samples, mid_block_res_sample = self.controlnet(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/models/controlnet.py", line 769, in forward
    sample = sample + controlnet_cond
RuntimeError: The size of tensor a (64) must match the size of tensor b (121) at non-singleton dimension 3

2023-09-15 10:46:10,470  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble_img2img
time: 6.217412948608398
traceback: c/lib/python3.10/site-packages/starlette/middleware/base.py", line 70, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/cors.py", line 84, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 279, in diff_scribble_img2img
    control_img = scribble_pic(req.filepath, base64=False,rectange=True,crease64=True)
  File "/algo/gs/dl_aigc/main.py", line 202, in scribble_pic
    res = crease64(max(cv_img.shape[0],cv_img.shape[1]))
TypeError: 'bool' object is not callable

2023-09-15 10:47:59,223  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble_img2img
time: 6.806344270706177
traceback: thon3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 288, in diff_scribble_img2img
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 245, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py", line 1019, in __call__
    down_block_res_samples, mid_block_res_sample = self.controlnet(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/models/controlnet.py", line 769, in forward
    sample = sample + controlnet_cond
RuntimeError: The size of tensor a (56) must match the size of tensor b (40) at non-singleton dimension 3

2023-09-15 10:49:12,760  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble_img2img
time: 16.89927840232849
traceback: thon3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 289, in diff_scribble_img2img
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 246, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/pipelines/controlnet/pipeline_controlnet_img2img.py", line 1019, in __call__
    down_block_res_samples, mid_block_res_sample = self.controlnet(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1501, in _call_impl
    return forward_call(*args, **kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/models/controlnet.py", line 769, in forward
    sample = sample + controlnet_cond
RuntimeError: The size of tensor a (56) must match the size of tensor b (40) at non-singleton dimension 3

2023-09-15 12:49:43,210  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble
time: 0.0045337677001953125
traceback: lf.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 263, in diff_scribble
    control_img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 206, in scribble_pic
    cv_img = scribble_xdog(cv_img, res=res, thr_a=16)
  File "/algo/gs/dl_aigc/xdog.py", line 48, in scribble_xdog
    img, remove_pad = resize_image_with_pad(img, res)
  File "/algo/gs/dl_aigc/xdog.py", line 31, in resize_image_with_pad
    img = HWC3(input_image)
  File "/algo/gs/dl_aigc/xdog.py", line 12, in HWC3
    assert x.dtype == np.uint8
AttributeError: 'NoneType' object has no attribute 'dtype'

2023-09-15 12:49:43,212  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble
time: 0.007911205291748047
traceback: lf.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 263, in diff_scribble
    control_img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 206, in scribble_pic
    cv_img = scribble_xdog(cv_img, res=res, thr_a=16)
  File "/algo/gs/dl_aigc/xdog.py", line 48, in scribble_xdog
    img, remove_pad = resize_image_with_pad(img, res)
  File "/algo/gs/dl_aigc/xdog.py", line 31, in resize_image_with_pad
    img = HWC3(input_image)
  File "/algo/gs/dl_aigc/xdog.py", line 12, in HWC3
    assert x.dtype == np.uint8
AttributeError: 'NoneType' object has no attribute 'dtype'

2023-09-15 12:49:43,214  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble
time: 0.009708642959594727
traceback: lf.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 263, in diff_scribble
    control_img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 206, in scribble_pic
    cv_img = scribble_xdog(cv_img, res=res, thr_a=16)
  File "/algo/gs/dl_aigc/xdog.py", line 48, in scribble_xdog
    img, remove_pad = resize_image_with_pad(img, res)
  File "/algo/gs/dl_aigc/xdog.py", line 31, in resize_image_with_pad
    img = HWC3(input_image)
  File "/algo/gs/dl_aigc/xdog.py", line 12, in HWC3
    assert x.dtype == np.uint8
AttributeError: 'NoneType' object has no attribute 'dtype'

2023-09-15 12:49:43,217  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble
time: 0.011428117752075195
traceback: lf.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 263, in diff_scribble
    control_img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 206, in scribble_pic
    cv_img = scribble_xdog(cv_img, res=res, thr_a=16)
  File "/algo/gs/dl_aigc/xdog.py", line 48, in scribble_xdog
    img, remove_pad = resize_image_with_pad(img, res)
  File "/algo/gs/dl_aigc/xdog.py", line 31, in resize_image_with_pad
    img = HWC3(input_image)
  File "/algo/gs/dl_aigc/xdog.py", line 12, in HWC3
    assert x.dtype == np.uint8
AttributeError: 'NoneType' object has no attribute 'dtype'

2023-09-15 12:57:27,364  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble
time: 0.0032935142517089844
traceback: lf.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 263, in diff_scribble
    control_img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 206, in scribble_pic
    cv_img = scribble_xdog(cv_img, res=res, thr_a=16)
  File "/algo/gs/dl_aigc/xdog.py", line 48, in scribble_xdog
    img, remove_pad = resize_image_with_pad(img, res)
  File "/algo/gs/dl_aigc/xdog.py", line 31, in resize_image_with_pad
    img = HWC3(input_image)
  File "/algo/gs/dl_aigc/xdog.py", line 12, in HWC3
    assert x.dtype == np.uint8
AttributeError: 'NoneType' object has no attribute 'dtype'

2023-09-15 12:57:27,366  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble
time: 0.005158662796020508
traceback: lf.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 263, in diff_scribble
    control_img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 206, in scribble_pic
    cv_img = scribble_xdog(cv_img, res=res, thr_a=16)
  File "/algo/gs/dl_aigc/xdog.py", line 48, in scribble_xdog
    img, remove_pad = resize_image_with_pad(img, res)
  File "/algo/gs/dl_aigc/xdog.py", line 31, in resize_image_with_pad
    img = HWC3(input_image)
  File "/algo/gs/dl_aigc/xdog.py", line 12, in HWC3
    assert x.dtype == np.uint8
AttributeError: 'NoneType' object has no attribute 'dtype'

2023-09-15 12:57:27,368  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble
time: 0.0068929195404052734
traceback: lf.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 263, in diff_scribble
    control_img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 206, in scribble_pic
    cv_img = scribble_xdog(cv_img, res=res, thr_a=16)
  File "/algo/gs/dl_aigc/xdog.py", line 48, in scribble_xdog
    img, remove_pad = resize_image_with_pad(img, res)
  File "/algo/gs/dl_aigc/xdog.py", line 31, in resize_image_with_pad
    img = HWC3(input_image)
  File "/algo/gs/dl_aigc/xdog.py", line 12, in HWC3
    assert x.dtype == np.uint8
AttributeError: 'NoneType' object has no attribute 'dtype'

2023-09-15 12:57:27,373  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble
time: 0.0012323856353759766
traceback: lf.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 263, in diff_scribble
    control_img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 206, in scribble_pic
    cv_img = scribble_xdog(cv_img, res=res, thr_a=16)
  File "/algo/gs/dl_aigc/xdog.py", line 48, in scribble_xdog
    img, remove_pad = resize_image_with_pad(img, res)
  File "/algo/gs/dl_aigc/xdog.py", line 31, in resize_image_with_pad
    img = HWC3(input_image)
  File "/algo/gs/dl_aigc/xdog.py", line 12, in HWC3
    assert x.dtype == np.uint8
AttributeError: 'NoneType' object has no attribute 'dtype'

2023-09-15 12:58:45,928  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble
time: 0.003945112228393555
traceback: lf.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 263, in diff_scribble
    control_img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 206, in scribble_pic
    cv_img = scribble_xdog(cv_img, res=res, thr_a=16)
  File "/algo/gs/dl_aigc/xdog.py", line 48, in scribble_xdog
    img, remove_pad = resize_image_with_pad(img, res)
  File "/algo/gs/dl_aigc/xdog.py", line 31, in resize_image_with_pad
    img = HWC3(input_image)
  File "/algo/gs/dl_aigc/xdog.py", line 12, in HWC3
    assert x.dtype == np.uint8
AttributeError: 'NoneType' object has no attribute 'dtype'

2023-09-15 12:58:45,930  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble
time: 0.005693912506103516
traceback: lf.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 263, in diff_scribble
    control_img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 206, in scribble_pic
    cv_img = scribble_xdog(cv_img, res=res, thr_a=16)
  File "/algo/gs/dl_aigc/xdog.py", line 48, in scribble_xdog
    img, remove_pad = resize_image_with_pad(img, res)
  File "/algo/gs/dl_aigc/xdog.py", line 31, in resize_image_with_pad
    img = HWC3(input_image)
  File "/algo/gs/dl_aigc/xdog.py", line 12, in HWC3
    assert x.dtype == np.uint8
AttributeError: 'NoneType' object has no attribute 'dtype'

2023-09-15 12:58:45,932  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble
time: 0.007309913635253906
traceback: lf.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 263, in diff_scribble
    control_img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 206, in scribble_pic
    cv_img = scribble_xdog(cv_img, res=res, thr_a=16)
  File "/algo/gs/dl_aigc/xdog.py", line 48, in scribble_xdog
    img, remove_pad = resize_image_with_pad(img, res)
  File "/algo/gs/dl_aigc/xdog.py", line 31, in resize_image_with_pad
    img = HWC3(input_image)
  File "/algo/gs/dl_aigc/xdog.py", line 12, in HWC3
    assert x.dtype == np.uint8
AttributeError: 'NoneType' object has no attribute 'dtype'

2023-09-15 12:58:45,934  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble
time: 0.009376764297485352
traceback: lf.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 263, in diff_scribble
    control_img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 206, in scribble_pic
    cv_img = scribble_xdog(cv_img, res=res, thr_a=16)
  File "/algo/gs/dl_aigc/xdog.py", line 48, in scribble_xdog
    img, remove_pad = resize_image_with_pad(img, res)
  File "/algo/gs/dl_aigc/xdog.py", line 31, in resize_image_with_pad
    img = HWC3(input_image)
  File "/algo/gs/dl_aigc/xdog.py", line 12, in HWC3
    assert x.dtype == np.uint8
AttributeError: 'NoneType' object has no attribute 'dtype'

2023-09-15 12:59:55,255  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble
time: 0.005334615707397461
traceback: lf.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 263, in diff_scribble
    control_img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 206, in scribble_pic
    cv_img = scribble_xdog(cv_img, res=res, thr_a=16)
  File "/algo/gs/dl_aigc/xdog.py", line 48, in scribble_xdog
    img, remove_pad = resize_image_with_pad(img, res)
  File "/algo/gs/dl_aigc/xdog.py", line 31, in resize_image_with_pad
    img = HWC3(input_image)
  File "/algo/gs/dl_aigc/xdog.py", line 12, in HWC3
    assert x.dtype == np.uint8
AttributeError: 'NoneType' object has no attribute 'dtype'

2023-09-15 12:59:55,257  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble
time: 0.007121086120605469
traceback: lf.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 263, in diff_scribble
    control_img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 206, in scribble_pic
    cv_img = scribble_xdog(cv_img, res=res, thr_a=16)
  File "/algo/gs/dl_aigc/xdog.py", line 48, in scribble_xdog
    img, remove_pad = resize_image_with_pad(img, res)
  File "/algo/gs/dl_aigc/xdog.py", line 31, in resize_image_with_pad
    img = HWC3(input_image)
  File "/algo/gs/dl_aigc/xdog.py", line 12, in HWC3
    assert x.dtype == np.uint8
AttributeError: 'NoneType' object has no attribute 'dtype'

2023-09-15 12:59:55,259  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble
time: 0.008711099624633789
traceback: lf.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 263, in diff_scribble
    control_img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 206, in scribble_pic
    cv_img = scribble_xdog(cv_img, res=res, thr_a=16)
  File "/algo/gs/dl_aigc/xdog.py", line 48, in scribble_xdog
    img, remove_pad = resize_image_with_pad(img, res)
  File "/algo/gs/dl_aigc/xdog.py", line 31, in resize_image_with_pad
    img = HWC3(input_image)
  File "/algo/gs/dl_aigc/xdog.py", line 12, in HWC3
    assert x.dtype == np.uint8
AttributeError: 'NoneType' object has no attribute 'dtype'

2023-09-15 12:59:55,261  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble
time: 0.010268688201904297
traceback: lf.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 263, in diff_scribble
    control_img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 206, in scribble_pic
    cv_img = scribble_xdog(cv_img, res=res, thr_a=16)
  File "/algo/gs/dl_aigc/xdog.py", line 48, in scribble_xdog
    img, remove_pad = resize_image_with_pad(img, res)
  File "/algo/gs/dl_aigc/xdog.py", line 31, in resize_image_with_pad
    img = HWC3(input_image)
  File "/algo/gs/dl_aigc/xdog.py", line 12, in HWC3
    assert x.dtype == np.uint8
AttributeError: 'NoneType' object has no attribute 'dtype'

2023-09-15 13:07:05,143  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble
time: 0.0032639503479003906
traceback: lf.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 263, in diff_scribble
    control_img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 206, in scribble_pic
    cv_img = scribble_xdog(cv_img, res=res, thr_a=16)
  File "/algo/gs/dl_aigc/xdog.py", line 48, in scribble_xdog
    img, remove_pad = resize_image_with_pad(img, res)
  File "/algo/gs/dl_aigc/xdog.py", line 31, in resize_image_with_pad
    img = HWC3(input_image)
  File "/algo/gs/dl_aigc/xdog.py", line 12, in HWC3
    assert x.dtype == np.uint8
AttributeError: 'NoneType' object has no attribute 'dtype'

2023-09-15 13:07:05,145  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble
time: 0.005103588104248047
traceback: lf.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 263, in diff_scribble
    control_img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 206, in scribble_pic
    cv_img = scribble_xdog(cv_img, res=res, thr_a=16)
  File "/algo/gs/dl_aigc/xdog.py", line 48, in scribble_xdog
    img, remove_pad = resize_image_with_pad(img, res)
  File "/algo/gs/dl_aigc/xdog.py", line 31, in resize_image_with_pad
    img = HWC3(input_image)
  File "/algo/gs/dl_aigc/xdog.py", line 12, in HWC3
    assert x.dtype == np.uint8
AttributeError: 'NoneType' object has no attribute 'dtype'

2023-09-15 13:07:05,147  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble
time: 0.006799459457397461
traceback: lf.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 263, in diff_scribble
    control_img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 206, in scribble_pic
    cv_img = scribble_xdog(cv_img, res=res, thr_a=16)
  File "/algo/gs/dl_aigc/xdog.py", line 48, in scribble_xdog
    img, remove_pad = resize_image_with_pad(img, res)
  File "/algo/gs/dl_aigc/xdog.py", line 31, in resize_image_with_pad
    img = HWC3(input_image)
  File "/algo/gs/dl_aigc/xdog.py", line 12, in HWC3
    assert x.dtype == np.uint8
AttributeError: 'NoneType' object has no attribute 'dtype'

2023-09-15 13:07:05,152  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble
time: 0.0012171268463134766
traceback: lf.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 263, in diff_scribble
    control_img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 206, in scribble_pic
    cv_img = scribble_xdog(cv_img, res=res, thr_a=16)
  File "/algo/gs/dl_aigc/xdog.py", line 48, in scribble_xdog
    img, remove_pad = resize_image_with_pad(img, res)
  File "/algo/gs/dl_aigc/xdog.py", line 31, in resize_image_with_pad
    img = HWC3(input_image)
  File "/algo/gs/dl_aigc/xdog.py", line 12, in HWC3
    assert x.dtype == np.uint8
AttributeError: 'NoneType' object has no attribute 'dtype'

2023-09-15 13:10:53,855  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble
time: 0.005876064300537109
traceback: iniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/cors.py", line 84, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 263, in diff_scribble
    control_img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 186, in scribble_pic
    cv_img = base64_cv(base64str)
  File "/algo/gs/dl_aigc/img_util.py", line 19, in base64_cv
    img = cv2.imdecode(im_arr, flags=cv2.IMREAD_COLOR)
cv2.error: OpenCV(4.8.0) /io/opencv/modules/imgcodecs/src/loadsave.cpp:802: error: (-215:Assertion failed) !buf.empty() in function 'imdecode_'


2023-09-15 13:10:53,857  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble
time: 0.007868051528930664
traceback: iniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/cors.py", line 84, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 263, in diff_scribble
    control_img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 186, in scribble_pic
    cv_img = base64_cv(base64str)
  File "/algo/gs/dl_aigc/img_util.py", line 19, in base64_cv
    img = cv2.imdecode(im_arr, flags=cv2.IMREAD_COLOR)
cv2.error: OpenCV(4.8.0) /io/opencv/modules/imgcodecs/src/loadsave.cpp:802: error: (-215:Assertion failed) !buf.empty() in function 'imdecode_'


2023-09-15 13:10:53,858  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble
time: 0.008114337921142578
traceback: iniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/cors.py", line 84, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 263, in diff_scribble
    control_img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 186, in scribble_pic
    cv_img = base64_cv(base64str)
  File "/algo/gs/dl_aigc/img_util.py", line 19, in base64_cv
    img = cv2.imdecode(im_arr, flags=cv2.IMREAD_COLOR)
cv2.error: OpenCV(4.8.0) /io/opencv/modules/imgcodecs/src/loadsave.cpp:802: error: (-215:Assertion failed) !buf.empty() in function 'imdecode_'


2023-09-15 13:10:53,860  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble
time: 0.009613752365112305
traceback: iniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/cors.py", line 84, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 263, in diff_scribble
    control_img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 186, in scribble_pic
    cv_img = base64_cv(base64str)
  File "/algo/gs/dl_aigc/img_util.py", line 19, in base64_cv
    img = cv2.imdecode(im_arr, flags=cv2.IMREAD_COLOR)
cv2.error: OpenCV(4.8.0) /io/opencv/modules/imgcodecs/src/loadsave.cpp:802: error: (-215:Assertion failed) !buf.empty() in function 'imdecode_'


2023-09-15 13:11:59,012  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble
time: 0.009532928466796875
traceback: iniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/cors.py", line 84, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 263, in diff_scribble
    control_img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 186, in scribble_pic
    cv_img = base64_cv(base64str)
  File "/algo/gs/dl_aigc/img_util.py", line 19, in base64_cv
    img = cv2.imdecode(im_arr, flags=cv2.IMREAD_COLOR)
cv2.error: OpenCV(4.8.0) /io/opencv/modules/imgcodecs/src/loadsave.cpp:802: error: (-215:Assertion failed) !buf.empty() in function 'imdecode_'


2023-09-15 13:11:59,014  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble
time: 0.009838581085205078
traceback: iniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/cors.py", line 84, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 263, in diff_scribble
    control_img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 186, in scribble_pic
    cv_img = base64_cv(base64str)
  File "/algo/gs/dl_aigc/img_util.py", line 19, in base64_cv
    img = cv2.imdecode(im_arr, flags=cv2.IMREAD_COLOR)
cv2.error: OpenCV(4.8.0) /io/opencv/modules/imgcodecs/src/loadsave.cpp:802: error: (-215:Assertion failed) !buf.empty() in function 'imdecode_'


2023-09-15 13:11:59,016  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble
time: 0.011457681655883789
traceback: iniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/cors.py", line 84, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 263, in diff_scribble
    control_img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 186, in scribble_pic
    cv_img = base64_cv(base64str)
  File "/algo/gs/dl_aigc/img_util.py", line 19, in base64_cv
    img = cv2.imdecode(im_arr, flags=cv2.IMREAD_COLOR)
cv2.error: OpenCV(4.8.0) /io/opencv/modules/imgcodecs/src/loadsave.cpp:802: error: (-215:Assertion failed) !buf.empty() in function 'imdecode_'


2023-09-15 13:11:59,018  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble
time: 0.013244390487670898
traceback: iniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/cors.py", line 84, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 263, in diff_scribble
    control_img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 186, in scribble_pic
    cv_img = base64_cv(base64str)
  File "/algo/gs/dl_aigc/img_util.py", line 19, in base64_cv
    img = cv2.imdecode(im_arr, flags=cv2.IMREAD_COLOR)
cv2.error: OpenCV(4.8.0) /io/opencv/modules/imgcodecs/src/loadsave.cpp:802: error: (-215:Assertion failed) !buf.empty() in function 'imdecode_'


2023-09-15 13:12:30,416  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble
time: 0.003804922103881836
traceback: iniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/cors.py", line 84, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 263, in diff_scribble
    control_img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 186, in scribble_pic
    cv_img = base64_cv(base64str)
  File "/algo/gs/dl_aigc/img_util.py", line 19, in base64_cv
    img = cv2.imdecode(im_arr, flags=cv2.IMREAD_COLOR)
cv2.error: OpenCV(4.8.0) /io/opencv/modules/imgcodecs/src/loadsave.cpp:802: error: (-215:Assertion failed) !buf.empty() in function 'imdecode_'


2023-09-15 13:12:30,422  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble
time: 0.005991458892822266
traceback: iniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/cors.py", line 84, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 263, in diff_scribble
    control_img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 186, in scribble_pic
    cv_img = base64_cv(base64str)
  File "/algo/gs/dl_aigc/img_util.py", line 19, in base64_cv
    img = cv2.imdecode(im_arr, flags=cv2.IMREAD_COLOR)
cv2.error: OpenCV(4.8.0) /io/opencv/modules/imgcodecs/src/loadsave.cpp:802: error: (-215:Assertion failed) !buf.empty() in function 'imdecode_'


2023-09-15 13:12:30,424  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble
time: 0.008252382278442383
traceback: iniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/cors.py", line 84, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 263, in diff_scribble
    control_img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 186, in scribble_pic
    cv_img = base64_cv(base64str)
  File "/algo/gs/dl_aigc/img_util.py", line 19, in base64_cv
    img = cv2.imdecode(im_arr, flags=cv2.IMREAD_COLOR)
cv2.error: OpenCV(4.8.0) /io/opencv/modules/imgcodecs/src/loadsave.cpp:802: error: (-215:Assertion failed) !buf.empty() in function 'imdecode_'


2023-09-15 13:12:30,426  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble
time: 0.010042428970336914
traceback: iniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/cors.py", line 84, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 263, in diff_scribble
    control_img = scribble_pic(req.base64str, base64=True)
  File "/algo/gs/dl_aigc/main.py", line 186, in scribble_pic
    cv_img = base64_cv(base64str)
  File "/algo/gs/dl_aigc/img_util.py", line 19, in base64_cv
    img = cv2.imdecode(im_arr, flags=cv2.IMREAD_COLOR)
cv2.error: OpenCV(4.8.0) /io/opencv/modules/imgcodecs/src/loadsave.cpp:802: error: (-215:Assertion failed) !buf.empty() in function 'imdecode_'


2023-09-15 13:29:26,779  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diffusion
time: 4.259662389755249
traceback: __
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 277, in diffusion
    init_pipline("diffusion")
  File "/algo/gs/dl_aigc/main.py", line 172, in init_pipline
    app.state.pipeline = StableDiffusionControlNetImg2ImgPipeline.from_pretrained(
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/pipelines/pipeline_utils.py", line 1191, in from_pretrained
    raise ValueError(
ValueError: Pipeline <class 'diffusers.pipelines.controlnet.pipeline_controlnet_img2img.StableDiffusionControlNetImg2ImgPipeline'> expected {'text_encoder', 'controlnet', 'unet', 'scheduler', 'safety_checker', 'tokenizer', 'feature_extractor', 'vae'}, but only {'text_encoder', 'unet', 'scheduler', 'safety_checker', 'tokenizer', 'feature_extractor', 'vae'} were passed.

2023-09-15 13:51:51,378  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diffusion
time: 3.0569775104522705
traceback: /dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 279, in diffusion
    init_pipline("diffusion")
  File "/algo/gs/dl_aigc/main.py", line 172, in init_pipline
    app.state.pipeline = StableDiffusionPipeline.from_pretrained(
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/pipelines/pipeline_utils.py", line 1196, in from_pretrained
    model = pipeline_class(**init_kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/pipelines/stable_diffusion/pipeline_stable_diffusion.py", line 183, in __init__
    self.register_modules(
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/pipelines/pipeline_utils.py", line 519, in register_modules
    library = not_compiled_module.__module__.split(".")[0]
AttributeError: 'bool' object has no attribute '__module__'

2023-09-15 13:55:27,076  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diffusion
time: 3.075407028198242
traceback: e/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 279, in diffusion
    init_pipline("diffusion")
  File "/algo/gs/dl_aigc/main.py", line 172, in init_pipline
    app.state.pipeline = StableDiffusionPipeline.from_pretrained(
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/pipelines/pipeline_utils.py", line 1196, in from_pretrained
    model = pipeline_class(**init_kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/pipelines/stable_diffusion/pipeline_stable_diffusion.py", line 183, in __init__
    self.register_modules(
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/pipelines/pipeline_utils.py", line 519, in register_modules
    library = not_compiled_module.__module__.split(".")[0]
AttributeError: 'str' object has no attribute '__module__'

2023-09-15 14:00:59,175  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diffusion
time: 0.0008747577667236328
traceback: te/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 280, in diffusion
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 257, in pipline_process
    images = app.state.pipeline(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 115, in decorate_context
    return func(*args, **kwargs)
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/pipelines/stable_diffusion/pipeline_stable_diffusion.py", line 613, in __call__
    self.check_inputs(
  File "/algo/gs/dl_aigc/diffusers-0.21.0/src/diffusers/pipelines/stable_diffusion/pipeline_stable_diffusion.py", line 467, in check_inputs
    raise ValueError(f"`height` and `width` have to be divisible by 8 but are {height} and {width}.")
ValueError: `height` and `width` have to be divisible by 8 but are 536 and 969.

2023-09-15 15:24:08,331  ERROR       main.py  db_session_middleware  82  status: 500
params: 
path_params: /diff_scribble_img2img
time: 5.2623374462127686
traceback:   await self.app(scope, receive_or_disconnect, send_no_error)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/cors.py", line 84, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 79, in __call__
    raise exc
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 68, in __call__
    await self.app(scope, receive, sender)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 718, in __call__
    await route.handle(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 276, in handle
    await self.app(scope, receive, send)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/starlette/routing.py", line 66, in app
    response = await func(request)
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 237, in app
    raw_response = await run_endpoint_function(
  File "/home/dl/miniconda3/envs/aigc/lib/python3.10/site-packages/fastapi/routing.py", line 163, in run_endpoint_function
    return await dependant.call(**values)
  File "/algo/gs/dl_aigc/main.py", line 327, in diff_scribble_img2img
    images, seeds = pipline_process(
  File "/algo/gs/dl_aigc/main.py", line 247, in pipline_process
    width,height = crease8(width),crease8(height)
  File "/algo/gs/dl_aigc/xdog.py", line 8, in crease8
    return int(np.ceil(float(x) / 8.0) * 8)
TypeError: float() argument must be a string or a real number, not 'NoneType'

